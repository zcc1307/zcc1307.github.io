\documentclass{article}
\usepackage{fullpage}
\usepackage{physics}
\usepackage{amsmath,amssymb,amsthm}
\usepackage{commath}
\usepackage{algorithm, algorithmic}
\usepackage{natbib}

\newtheorem{example}{Example}
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}{Corollary}
\newtheorem{lemma}{Lemma}
\newtheorem{definition}{Definition}
\newtheorem{claim}{Claim}
\newtheorem{fact}{Fact}

\DeclareMathOperator*{\diag}{{\rm diag}}
\DeclareMathOperator*{\Reg}{{\rm Reg}}
\DeclareMathOperator*{\ope}{{\rm op}}
\DeclareMathOperator*{\hinge}{{\rm hinge}}
\DeclareMathOperator*{\kl}{{\rm kl}}
\DeclareMathOperator*{\h}{{\rm h}}
\DeclareMathOperator*{\KL}{{\rm KL}}
\DeclareMathOperator*{\nent}{{\rm H}}
\DeclareMathOperator*{\Bin}{{\rm B}}
\DeclareMathOperator{\Rad}{{\mathrm{Rad}}}
\DeclareMathOperator*{\R}{{\rm R}}
\DeclareMathOperator*{\U}{{\rm U}}
\DeclareMathOperator*{\N}{{\rm N}}
\DeclareMathOperator*{\Var}{{\rm Var}}
\DeclareMathOperator*{\err}{{\rm err}}
\DeclareMathOperator*{\sign}{{\rm sign}}
\DeclareMathOperator*{\Xcal}{{\cal X}}
%\DeclareMathOperator*{\Hcal}{{\cal H}}
\DeclareMathOperator*{\Ycal}{{\cal Y}}
\DeclareMathOperator*{\Acal}{{\cal A}}
\DeclareMathOperator*{\Bcal}{{\cal B}}
\DeclareMathOperator*{\Zcal}{{\cal Z}}
\DeclareMathOperator*{\Gcal}{{\cal G}}
\DeclareMathOperator*{\Ccal}{{\cal C}}
\DeclareMathOperator*{\CH}{{\rm CH}}
%\DeclareMathOperator*{\Fcal}{{\cal F}}
\DeclareMathOperator*{\Scal}{{\cal S}}
\DeclareMathOperator*{\Ical}{{\cal I}}
\DeclareMathOperator*{\argmin}{{\rm argmin}}
\DeclareMathOperator*{\argmax}{{\rm argmax}}
\DeclareMathOperator*{\maximize}{{\rm maximize}}
\DeclareMathOperator*{\minimize}{{\rm minimize}}
\DeclareMathOperator*{\st}{{\rm s.t.}}
\DeclareMathOperator*{\VC}{{\rm VC}}
\DeclareMathOperator{\EE}{{\mathbb E}}
\DeclareMathOperator{\PP}{{\mathbb P}}
\newcommand{\RR}{\mathbb{R}} % Real numbers
%\newcommand{\EE}{\mathbb{E}}
%\newcommand{\PP}{\mathbb{P}}
\newcommand{\NN}{\mathbb{N}}
\newcommand{\Hcal}{\mathcal{H}}
\newcommand{\Fcal}{\mathcal{F}}
\newcommand{\Ocal}{\mathcal{O}}
\newcommand{\defeq}{\triangleq}
\newcommand*{\one}{{\bf 1}}
\newcommand{\inner}[2]{\left\langle #1,#2 \right\rangle}
\DeclareMathOperator*{\Ber}{{\rm Bernoulli}}

\title{CSC 665: Online convex optimization}
\author{Chicheng Zhang}

\begin{document}
\maketitle

\section{Background}

\subsection{Norms}
\begin{definition}
A function $\| \cdot \|: \RR^d \to \RR_+$ (that maps $x$ to $\|x\|$) is called a norm, if the following holds:
\begin{enumerate}
\item(Homogeneity) $\forall a \in \RR$, $\| ax \| = |a| \| x \|$.
\item(Triangle inequality) $\forall x, y \in \RR^d$, $\| x + y \| \leq \| x \| + \|y\|$.
\item(Point separation) If $\| v \| = 0$, then $v = \vec{0}$. In other words, all nonzero vectors have nonzero norms.
\end{enumerate}
\end{definition}

\begin{definition}
For a norm $\| \cdot \|$, define its dual norm as follows:
\[ \| z \|_\star = \sup_{x: \| x \| \leq 1} \inner{x}{z}. \]
(It can be checked that $\| \cdot \|_\star$ also satisfies the requirements of a norm.)
\end{definition}

\begin{example}
\begin{enumerate}
  \item $\| \cdot \|_2$ has dual norm $\| \cdot \|_2$.
  \item In general, for $p, q \in [1,\infty]$ being conjugate exponents, that is $\frac1p + \frac1q = 1$, $\| \cdot\|_p$ has dual norm $\| \cdot \|_q$.
  \item Given a positive definite matrix $A$, define $\| x \|_A = \sqrt{x^\top A x}$. It has dual norm $\| \cdot \|_{A^{-1}}$.
\end{enumerate}
\end{example}

\begin{fact}[``Cauchy-Schwarz'' for general norms]
For any norm $\| \|$ and its dual norm $\| \|_\star$, and any two points
$x, z \in \RR^d$,
\[ \inner{x}{z} \leq \| x \| \| z \|_\star. \]
\end{fact}
The fact simply follows from the definition of dual norm.

One might wonder, $\| \cdot\|$ has dual norm $\| \cdot\|_\star$, but
what is the dual norm of $\| \cdot\|_\star$? It turns out that under mild assumptions, the dual of $\|\cdot \|_\star$ is $\|\cdot \|$.

%A $d \times d$ matrix $M$ can be viewed as a linear operator that maps $x \in \RR^d$ to $Mx \in \RR^d$. Sometimes it would be convenient to consider the following operator norm:
%\begin{definition}
%Suppose $\| \cdot \|$ is a norm on $\RR^d$. Define the opeator norm of a matrix $M$ as:
%\[ \| M\|_{\ope} = \max_{x: \| x \| \leq 1} \| M x \|_\star \]
%\end{definition}

%\begin{example}
%  \begin{enumerate}
%    \item The operator norm of $M$ with respect to $\| \cdot \|_2$ is $\sigma_{1}(M)$, where $\sigma_{1}(A)$ denotes the maximum singular value of $A$.
%    \item The operator norm of $M$ with respect to $\| \cdot \|_1$ is
%  \end{enumerate}
%\end{example}

\subsection{Convexity}

\begin{definition}
Define convex sets and convex functions as follows:
\begin{enumerate}
\item For any $u$, $v$ and any $\alpha \in [0,1]$, the {\em convex combination} between $u$ and $v$ with coefficient $\alpha$ is defined as $\alpha u + (1-\alpha) v$.

\item A set $\Ccal \subset \RR^d$ is {\em convex}, if for $u$ and $v$ in $\Ccal$, and any coefficient $\alpha \in [0,1]$, their convex combination with coefficient $\alpha$ is in $\Ccal$.

\item A function $f: \Ccal \to \RR$ is {\em convex}, if (1) its domain $\Ccal$ is convex, (2) for any $u$, $v$ in $\Ccal$, and any $\alpha \in [0,1]$, $f(\alpha u + (1-\alpha)v) \leq \alpha f(u) + (1-\alpha) f(v)$.
\end{enumerate}
\end{definition}

If we have a convex function $f$ on a convex domain $\Ccal$, we define its extension to $\RR^d$ as
\begin{equation}
   \bar{f}(x) = \begin{cases} f(x) & x \in \Ccal \\ +\infty & x \notin \Ccal \end{cases}.
   \label{eqn:extend-rd}
 \end{equation}
Sometimes we will use $f: \Ccal \to \RR$ and $\bar{f}: \RR^d \to \RR \cup \cbr{+\infty}$ interchangably.


\begin{fact}[Local minimum vs. global minimum]
Suppose $f$ is a convex function. If $x$ is a local minimum of $f$, in that there exists a radius $r > 0$ such that for all $y$ such that $\| y - x\| \leq r$, $f(x) \leq f(y)$, then $x$ is also a global minimum $f$.
\end{fact}

\begin{definition}[Subgradient]
Given a convex function $f: \Ccal \to \RR$ and a point $v \in \Ccal$, define $\partial f(v)$ as the set of $g \in \RR^d$'s such that:
\[ \forall u \in \Ccal, \quad f(u) \geq f(v) + \inner{g}{u - v}. \]
\end{definition}

Therefore, for convex $f$, if $0 \in \partial f(x^\star)$, then $x^\star$ is the global minimum of $f$. However for $f: \Ccal \to \RR$, a global minimum of $f$ in $\Ccal$ may not necessarily have zero subgradient: for example, suppose $\Ccal = [-1,+1]$ and $f(x) = x$, then the global minimum $x^\star = -1$, but $f$ has subgradient $1$ on $x^\star$. Nevertheless, we have the following first order optimality condition.

\begin{fact}[First order optimality condition]
For a convex set $\Ccal$ and $f: \Ccal \to \RR$. Suppose $x^\star \in \Ccal$ is the global minimum of $f$, then we have that there exists $g \in \partial f(x^\star)$:
\begin{equation}
   \forall x \in \Ccal, \quad \inner{g}{x - x^\star} \geq 0.
   \label{eqn:first-order}
 \end{equation}
\label{fact:first-order}
\end{fact}
The proof of this fact is not trivial and can be found at~\cite[][Proposition 4.7.2]{bertsekas2003convex}. We make the following two remarks:
\begin{enumerate}
\item The ``exists $g \in \partial f(x^\star)$'' cannot be replaced with ``for any $g \in \partial f(x^\star)$'': for example, if $f(x) = |x|$ over $\Ccal = [-1,+1]$, $x^\star = 0$, but we can only take $g = 0 \in \partial f(0)$ such that Equation~\eqref{eqn:first-order} is true.
\item If $f$ is differentiable, then the above fact is not hard to show: indeed, we only need to check that $\forall x \in \Ccal, \quad \inner{\nabla f(x^\star)}{x - x^\star} \geq 0$. If this were not true, i.e. $\inner{\nabla f(x^\star)}{x - x^\star} < 0$, then it can be seen that
\[ f(x^\star + \alpha(x - x^\star)) = f(x^\star) + \alpha \cdot \inner{\nabla f(x^\star)}{x - x^\star} + o(\alpha), \]
and is smaller than $f(x^\star)$ when $\alpha$ is small enough; contradiction.
\end{enumerate}

%\begin{proof}
%Suppose there exists
%\end{proof}

%It can be easily checked that the converse is also true. %This means that in some sense, convex optimization boils down to finding a point with a

\begin{fact}
For any convex $f: \Ccal \to \RR$ and a point $v \in \Ccal$, $\partial f(v) \neq \emptyset$, i.e. subgradient always exists. If $f$ is differentiable at $v$, then $\partial f(v) = \cbr{\nabla f(v)}$.
\end{fact}

\begin{example}
For function $f(x) = |x|$,
\[ \partial f(x) = \begin{cases} +1 & x > 0, \\ [-1,+1] & x = 0, \\ -1 & x < 0. \end{cases}\]
\end{example}

\begin{definition}[Bregman divergence]
For a differentiable convex function $f$, define its induced Bregman divergence on points $u$ and $v$ as:
\[ D_f(u, v) = f(u) - f(v) - \inner{\nabla f(v)}{u - v}. \]
\end{definition}
In words, $D_f(u, v)$ is the gap between $f$ and its first order approximation (using $v$) at location $u$. By convexity of $f$, $D_f(u, v)$ is always nonnegative. Interestingly, $D_f(u, v)$ may not agree with $D_f(v, u)$, as can be seen in the second example below.

\begin{example}
  \begin{enumerate}
  \item If $f(x) = \frac{\lambda}{2}\|x\|^2$, then $D_f(u, v) = \frac{\lambda}{2}\|u - v\|_2^2$.
  \item If $f(x) = \sum_{i=1}^d x_i \ln x_i$, then $D_f(u, v)= \sum_{i=1}^d (u_i \ln\frac{u_i}{v_i} - u_i + v_i)$. This is the {\em unnormalized relative entropy} between $u$ and $v$; if both $u$ and $v$ are in $\Delta^{d-1}$, then $D_f(u, v)$ is the {\em relative entropy} between these two probability vectors.
\end{enumerate}
\end{example}


\begin{fact}[Building convex functions from simple ones]
Suppose $f_1, \ldots, f_n$ is a collection of convex functions.
\begin{enumerate}
\item If $w_1,\ldots, w_n \geq 0$, then $\sum_{i=1}^n w_i f_i(x)$ is convex.

\item Let $f(x) = \max(f_1(x), \ldots, f_n(x))$. Then $f$ is convex. Moreover, given an $x$,
$\partial f(x)$ contains elements of $\partial f_{i}(x)$, where $i \in \arg\max_{i=1}^n f_i(x)$.
\end{enumerate}
\label{fact:build-cvx}
\end{fact}


\begin{definition}
$f$ is $L$-Lipschitz with respect to norm $\| \cdot \|$ if for any $u, v$, $f(u) - f(v) \leq L\| u - v\|$.
\end{definition}

\begin{fact}
For any convex $f: \Ccal \to \RR$,
\[ f \text{ is } L-\text{Lipschitz} \Leftrightarrow \forall v, \forall g \in \partial f(v), \| g \|_\star \leq L. \]
\end{fact}

Therefore, for differentiable functions, to check Lipschitzness, it suffices to check that the gradients at all locations have uniformly-bounded norms.

\subsection{Strong convexity}

\begin{definition}[Strong convexity]
A function $f: \Ccal \to \RR$ is $\lambda$-strongly convex with respect to norm $\| \cdot \|$, if for any two points
$u, v \in \Ccal$, and $\alpha \in [0,1]$,
\[ f(\alpha u + (1-\alpha)v) \leq \alpha f(u) + (1-\alpha) f(v) - \frac{\lambda}{2}\alpha(1-\alpha) \| u - v\|^2. \]
\end{definition}

Strong convexity requires that the gap between interpolated function values and the function value of the interpolated input to have a quadratic lower bound. Clearly, if $f$ is $\lambda$-strongly convex, then $f$ is $\lambda'$-strongly convex for $\lambda' < \lambda$. Moreover, a function $f$ is $0$-strongly convex iff $f$ is convex.

We have the following simple additivity property on strong convexity simply by definition:
\begin{lemma}
If $f_1$ and $f_2$ are $\lambda_1$- and $\lambda_2$- strongly convex with respect to $\| \cdot \|$ respectively, then $f_1 + f_2$ is $\lambda_1 + \lambda_2$-strongly convex. Specifically, a $\lambda$-strongly convex function plus a convex function is still $\lambda$-strongly convex.
\end{lemma}


\begin{fact}
The following are equivalent:
\begin{enumerate}
  \item $f$ is $\lambda$-strongly convex.
  \item For any $v$ in $\Ccal$, and $g \in \partial f(v)$,
  \[ f(u) \geq f(v) + \inner{g}{u - v} + \frac{\lambda}{2}\| u - v\|^2, \forall u \in \Ccal. \]
  \item For any $v$ in $\Ccal$, there exists a vector $g$ such that:
  \[ f(u) \geq f(v) + \inner{g}{u - v} + \frac{\lambda}{2}\| u - v\|^2, \forall u \in \Ccal. \]
\end{enumerate}
\end{fact}

Properties 2 or 3 are sometimes easier to check than the original strong convexity definition. Specifically, if $f$ is differentiable, using the equivalence between items 1 and 2, strong convexity is equivalent to a quadratic lower bound on Bregman divergence: $D_f(u, v) \geq \frac{\lambda}{2}\|u-v\|^2$.

%In addition, the above fact directly implies the following simple additivity property of strong convexity.
%For


\begin{example}
\begin{enumerate}
  \item If $f(x) = \frac{\lambda}{2}\|x\|^2$, then $D_f(u, v) = \frac{\lambda}{2}\|u - v\|_2^2$. Therefore $f$ is $\lambda$-strongly convex with respect to $\| \cdot \|_2$.
  \item If $f(x) = \sum_{i=1}^d x_i \ln x_i, x \in \cbr{x \in \RR^d: x_i > 0, \forall i, \text{ and } \sum_{i=1}^d x_i \leq B_1}$,
  then it can be checked by second-order Taylor's Theorem that $D_f(u, v) \geq \frac{1}{2B_1}\|u - v\|_1^2$, in other words, $f$ is $\frac{1}{B_1}$-strongly convex with respect to $\| \cdot \|_1$.
\end{enumerate}
\end{example}

Strongly convex functions have unique global minima, as given by the following fact:
\begin{fact}
If $f: \Ccal \to \RR$ is $\lambda$-strongly convex, and $x^\star$ is a global minimum of $f$ in $\Ccal$, then
$f(x) - f(x^\star) \geq \frac{\lambda}2 \| x - x^\star \|^2$. Consequently, if $x \in \Ccal$ is such that $f(x) \leq f(x^\star)$, then $x = x^\star$.
\label{fact:sc-optimal}
\end{fact}
\begin{proof}
Note that for all $g \in \partial f(x^\star)$, we have that for all $x \in \Ccal$,
\[ f(x) - f(x^\star) \geq \inner{g}{x - x^\star} + \frac{\lambda}2 \| x - x^\star \|^2. \]
Now, by first order optimality condition (Fact~\ref{fact:first-order}), we also have that there exists $g_0 \in \partial f(x^\star)$, such that for all $x \in \Ccal$,
\[ \inner{g_0}{x - x^\star} \geq 0. \]
Combining the above two inequalities, we immediately conclude that
\[ f(x) - f(x^\star) \geq \frac{\lambda}2 \| x - x^\star \|^2.  \]
The second statement directly follows from the point separation property of norms.
\end{proof}

For twice-differentiable $f$,
strong convexity with respect to $\| \cdot \|_2$ reduces to the following simple
criterion.
\begin{fact}
Suppose $f$ is twice differentiable.
$f$ is $\lambda$-strongly convex with respect to $\| \cdot \|_2$ iff for any $x$,
$\nabla^2 f(x) \succeq \lambda I$.
\end{fact}

\subsection{Smoothness}

\begin{definition}[Smoothness]
A differentiable function $f$ is called $\beta$-smooth with respect to norm $\|\cdot \|$, if for any $u$, $v$,
$\| \nabla f(u) - \nabla f(v) \|_\star \leq \beta \| u - v \|$.
In other words, $\nabla f$ is $\beta$-Lipschitz with respect to $\| \cdot \|$.
\end{definition}

\begin{fact}
The following are equivalent:
\begin{enumerate}
  \item $f$ is $\beta$-smooth with respect to norm $\| \cdot \|$.
  \item For any $u, v$, $f(u) \leq f(v) + \inner{\nabla f(v)}{u - v} + \frac{\beta}{2}\| u - v \|^2$.
  \item For any $u, v$, $f(u) \geq f(v) + \inner{\nabla f(v)}{u - v} + \frac{1}{2\beta} \| \nabla f(u) - \nabla f(v) \|^2$.
\end{enumerate}
\end{fact}

It can be seen that, smoothness is opposite to strong convexity: it asks for a function $f$, $D_f(u, v) \leq \frac{\beta}{2}\| u - v\|^2$ for any $u$, $v$. Therefore, if $f$ is both $\lambda$-strongly convex and $\beta$-smooth, then $\lambda \leq \beta$.

Again for twice-differentiable function $f$ and $\ell_2$ norm, we have a simpler way
to check smoothness:
\begin{fact}
Suppose $f$ is twice differentiable.
$f$ is $\beta$-smooth with respect to $\| \cdot \|_2$ iff for any $x$,
$\nabla^2 f(x) \preceq \beta I$.
\end{fact}

\subsection{Legendre-Fenchel duality}

Main idea: given convex function $f: \Ccal \to \RR$, use all its tangents to charaterize it.

Fix a slope $s$, we would like find a tangent of $f$ with slope $s$. One charaterization of the tangent is that, go over all $x$'s, look at the gaps between $f(x)$ and $\inner{s}{x}$, and find the location with the smallest gap. This smallest gap is the offset $b$, such that $\inner{s}{x} + b$ is the tangent of $f$ with slope $s$.

As discussed above, the offeset can be written as:
\[ b(s) =  \min_{x \in \Ccal} \del{f(x) - \inner{s}{x}}. \]

We define the Legendre-Fenchel conjugate of $f$ as $-b(s)$, denoted as $f^\star(s)$. \begin{definition}
Given convex function $f: \Ccal \to \RR$, its Legendre-Fenchel conjugate (dual), $f^\star$, is defined as
\[ f^\star(s) = \max_{x \in \Ccal} \del{\inner{s}{x} - f(x)}. \]
\end{definition}

\paragraph{Remark.} Alternatively, if we extend $f$ to domain $\RR^d$ using the definition of $\bar{f}$ in Equation~\ref{eqn:extend-rd}, and taking the Legendre-Fenchel dual, we get the same $f^\star$. Namely,
\[ \max_{x \in \Ccal} \del{\inner{s}{x} - f(x)} = \max_{x \in \RR^d} \del{\inner{s}{x} - \bar{f}(x)}. \]
This can be easily seen by noting that if $x \notin \Ccal$, then it must not achieve the maximum on the function of $x$ on the right hand side, as $\inner{s}{x}-\bar{f}(x) = -\infty$.

As $f^\star$ is the pointwise maximum of a collection of convex functions, $f^\star$ is convex. Can we give a characterization of the subgradient of $f^\star$? Using a generalization of Fact~\ref{fact:build-cvx}, and the facts that $h_x(s) = \inner{s}{x} - f(x)$ has subgradient $x$, and $f^\star(s) = \max_x h_x(s)$,
we can see that
\[ \argmax_{x \in \Ccal} \del{\inner{s}{x} - f(x)} \in \partial f^\star (s). \]

Let us look at the dual of $f^\star$, that is $f^{\star\star}(x) = \max_{s} \del{\inner{x}{s} - f^\star(s)}$. This equation has a nice geometric interpretation. Recall that for each $s$, $\inner{x}{s} - f^\star(s)$ is the tangent of $f$ of slope $s$; therefore, by varying $s$ in $\RR$, we get a collection of lines below $f$. $f^{\star\star}$ is an upper envelope of these lines. Curiously, under mild assumptions, $f^{\star\star}$ is exactly the original function $f$.

\begin{fact}
Suppose $f$ is closed (in that $\cbr{(x,t) \in \RR^{d+1}: f(x) \leq t}$ is a closed set) and
convex, then $f^{\star\star} = f$. In words, the dual of the dual is the original function.
\end{fact}

%therefore, taking a pointwise maximum over all tangents, we get a convex lower envelope of $f$.
The following simple fact is by the definition of Legendre-Fenchel conjugate function:
\begin{fact}[Fenchel-Young's Inequality]
For any pairs of $x$ and $s$ in $\RR^d$,
\[ f(x) + f^\star(s) \geq \inner{x}{s}. \]
\end{fact}

\begin{example}
\begin{enumerate}
  \item For conjugate exponents $p, q \in (1,\infty)$ such that $\frac1p + \frac1q = 1$, if $f(x) = \frac{x^{p}}{p}$, then $f^\star(s) = \frac{s^q}{q}$. This is the classical Young's inequality.
  \item For any norm $\| \cdot \|$, if $f(x) = \frac\lambda2 \| x \|^2$, then $f^\star(s) = \frac1{2\lambda}\| s \|_\star^2$.
  \item If $f(x) = \begin{cases} \sum_{i=1}^d x_i \ln x_i, & x \in \Delta^{d-1} \\
   +\infty, & x \notin \Delta^{d-1} \end{cases}$, then $f^\star(s) = \ln \sum_{s=1}^d e^{s_i}$.
  \item If $f(x) = \begin{cases} \sum_{i=1}^d x_i \ln x_i, & x \succ 0 \\
   +\infty, & x \nsucc 0 \end{cases}$, then $f^\star(s) = \sum_{i=1}^d e^{s_i - 1}$.
\end{enumerate}
\end{example}


If $f \geq g$, then by the definition of conjugate function, $f^\star \leq g^\star$.

It can be shown that for a strongly convex $f$, $f^\star$ is differentiable. Specifically,
\[ \nabla f^\star(s) = \argmax_{x \in \Ccal} \del{\inner{s}{x} - f(x)}, \]
as $f$ is strongly convex, the right hand side has unique element and the equality
is thus well-defined.
%we have a simpler characterization of $\nabla f^\star$:


\begin{fact}
$f$ is $\lambda$-strongly convex with respect to $\| \cdot \|$ iff $f^\star$ is $\frac1\lambda$-smooth with respect to $\| \cdot \|_\star$.
\label{fact:sc-sm}
\end{fact}
\begin{proof}
We only show the ``only if'' here. The proof of the ``if'' statement can be found at~\cite[][Theorem 3]{kakade2012regularization}.
Our goal is to show that for $u, v$,
\[ \| x_u - x_v \|_\star \leq \frac1\lambda \| u - v\|, \]
where
\[ x_u = \nabla f^\star(u) = \argmin_{x \in \Ccal} h_u(x), \text{ where } h_u(x) = \del{f(x) - \inner{u}{x}} , \]
\[ x_v = \nabla f^\star(v) = \argmin_{x \in \Ccal} h_v(x), \text{ where } h_v(x) = \del{f(x) - \inner{v}{x}} . \]

Note that $h_u$ and $h_v$ are close to each other when $u$ and $v$ are close: but close functions may not necessarily imply that their optimal points are close to each other; for example, $f(x) = 0.01x$ has minimum at $-\infty$, and
$f(x) = -0.01x$ has minimum at $+\infty$; luckily, for strongly convex functions that differ by a small linear function, we show that their minimum points are close.

By the strong convexity of $h_u(x)$ (resp. $h_v(x)$) and the optimality of $x_u$ (resp. $x_v$), and Fact~\ref{fact:sc-optimal}, we have:
\[ h_u(x_v) \geq h_u(x_u) + \frac{\lambda}{2} \| x_u - x_v \|^2, \]
\[ h_v(x_u) \geq h_v(x_v) + \frac{\lambda}{2} \| x_u - x_v \|^2. \]
Summing the two inequalities up,
\[ \inner{u - v}{x_u - x_v} \geq \lambda \| x_u - x_v \|^2. \]
By the generalized Cauchy-Schwarz, we have
\[ \lambda \| x_u - x_v \|^2 \leq \| u -v \| \| x_u - x_v \|, \]
implying
\[ \| x_u - x_v \|_\star \leq \frac1\lambda \| u - v \|. \qedhere\]
\end{proof}

The above fact shows that, if $f$ is more ``curved'', then $f^\star$ is more ``flat'', and vice versa.
%Thanks to the above fact,

\section{Online convex optimization}

Setup~\cite{gordon1999regret, zinkevich2003online}: see Framework~\ref{framework:oco}.

Equivalent goal: minimize regret against {\em the best fixed point in hindsight}:
\[
\Reg(T, \Ccal) = \max_{w^\star \in \Ccal} \Reg(T, w^\star) = \sum_{t=1}^T f_t(w_t) - \min_{w^\star \in \Ccal} \sum_{t=1}^T f_t(w^\star),
\]
where
\[
\Reg(T, w^\star) = \sum_{t=1}^T f_t(w_t) - \sum_{t=1}^T f_t(w^\star).
\]

\begin{algorithm}
\caption{Online convex optimization (OCO)}
\begin{algorithmic}
\REQUIRE{Convex decision set $\Ccal$.}
\FOR{timesteps $t = 1,2,\ldots,T$:}
\STATE Learner chooses $w_t \in \Ccal$,
\STATE Learner receives a convex loss $f_t$.
\ENDFOR
\STATE Goal: minimize cumulative loss $\sum_{t=1}^T f_t(w_t)$.
\end{algorithmic}
\label{framework:oco}
\end{algorithm}

\begin{definition}
  Suppose for every $f_t$, $f_t(w) = \inner{g_t}{w}$ for some vector $g_t$,
  then the OCO problem is called an online linear optimization (OLO) problem.
\end{definition}

\subsection{Follow the regularized leader (FTRL) for OLO}
Given a $\lambda$-strongly convex regularization function $\Phi$, set
\begin{eqnarray*}
  w_t &=& \argmin_{w} \sum_{s=1}^{t-1} \inner{g_s}{w} + \Phi(w) \\
  &=& \argmax_{w} \inner{-G_{t-1}}{w} - \Phi(w) \\
  &=& \nabla \Phi^\star(-G_{t-1}),
\end{eqnarray*}
where $G_t = \sum_{s=1}^{t} g_s$ is the cumulative gradients. the mapping $\nabla \Phi^\star$ is called the {\em mirror map} or {\em link function}, that ``transports'' the cumulative negative gradient to a point in the decision space.

\begin{example}
We give a few instantiations of FTRL:
\begin{enumerate}
\item Hedge as FTRL: let $g_t = \ell_t$ for every $t$, and let $\Phi(w) = \begin{cases} \frac1\eta \sum_{i=1}^d w_i \ln w_i, & w \in \Delta^{d-1} \\
 +\infty, & w \notin \Delta^{d-1} \end{cases}$, then it can be checked that
 \[ w_{t,i} = \exp\del{-\eta \sum_{s=1}^{t-1} \ell_{s,i}}. \]

\item Online gradient descent: let $\Phi(w) = \frac{1}{2\eta}\| w \|_2^2$, then $R^\star(G) = \frac{\eta}{2} \| G \|_2^2$, and $\nabla R^\star(G) = \eta G$.
Therefore, $w_t = -\eta G_{t-1} = - \sum_{s=1}^{t-1} \eta g_s$. This is the cumulative sum of negative gradients, times a stepsize of $\eta$.

\item Online gradient descent with lazy projections: let $\Phi(w) = \begin{cases} \frac{1}{2\eta}\| w \|^2,& w \in \Ccal, \\ +\infty, & w \notin \Ccal \end{cases}$, then it can be shown that,
\[ w_t = \argmin_{w \in \Ccal} \| w - (-\eta G_{t-1}) \|_2, \]
which is the $\ell_2$-projection of the point returned by online gradient descent to the convex set $\Ccal$.
\end{enumerate}
\end{example}

In this theoreom below, we will show that FTRL has a small regret given an appropriately-tuned step size $\eta$.

\begin{theorem}
If $R$ is $\lambda$-strongly convex with respect to $\| \cdot \|$, then FTRL has the following regret agains benchmark $w^\star$:
\[ \Reg(T, w^\star) = \sum_{t=1}^T \inner{g_t}{w_t - w} \leq \Phi(w^\star) - \min_{w'} \Phi(w') + \frac1 \lambda \sum_{t=1}^T \| g_t \|_\star^2. \]
\label{thm:ftrl}
\end{theorem}

\begin{proof}
Recall that $f_t(w) = \inner{g_t}{w}$. We break the proof into two steps:
\begin{enumerate}
  \item Consider a 'look-ahead' prediction strategy named the ``be-the-regularized leader'' (BTRL), that is, at time $t$, $w_{t+1}$'s are selected as the decision point. We will show that BTRL has a small regret.
  \item Note that BTRL cannot be implemented as a real algorithm: $w_{t+1}$ relies on information on $g_t$, which is unavailable at the beginning of round $t$. Nevertheless, we will show that $w_t$, the decision point selected by FTRL, is close to $w_{t+1}$, therefore the regret of FTRL can be bounded in terms of that of BTRL.
\end{enumerate}

\paragraph{Step 1: Analysis of BTRL.} Denote by $f_0(w) = \Phi(w)$. Consider a modification of the original OCO game: there is an extra round of online convex optimization at the beginning, namely round 0. Therefore, algorithmically, BTRL is equivalent to Be-the-leader (BTL) on $\cbr{f_0, f_1, \ldots, f_T}$.
We will show that BTL has nonpositive regret on this modified OCO game, and relate this regret guarantee to that of the original OCO game.
\begin{lemma}[Be the leader]
For any $w^\star$,
\[ \sum_{t=0}^T f_t(w_{t+1}) \leq \sum_{t=0}^T f_t(w^\star). \]
\label{lem:btl}
\end{lemma}
\begin{proof}
This is best illustrated by iteratively relaxing the right hand side; as $w_{T+1} = \argmin_w \sum_{t=0}^T f_t(w)$, we have that
\[ \sum_{t=0}^T f_t(w_{T+1}) \leq \sum_{t=0}^T f_t(w^\star). \]
Now let us focus on all but the last term in the left hand side, that is, $\sum_{t=0}^{T-1} f_t(w_{t+1})$. As as $w_{T} = \argmin_w \sum_{t=0}^{T-1} f_t(w)$, we have that
\[ \del{\sum_{t=0}^{T-1} f_t(w_T)} + f_T(w_{T+1}) \leq \sum_{t=0}^T f_t(w_{T+1}) \leq \sum_{t=0}^T f_t(w^\star). \]
By iteratively using the fact that $w_{\tau} = \argmin_w \sum_{t=0}^{\tau-1} f_t(w)$, we have that
\[ \del{\sum_{t=0}^{\tau-1} f_t(w_\tau)} + f_{\tau}(w_{\tau+1}) + \ldots + f_{T}(w_{T+1}) \leq \sum_{t=0}^T f_t(w^\star). \]
The lemma is a direct consequence of the above inequality in the case of $\tau = 1$.
\end{proof}

Lemma~\ref{lem:btl} immediately implies that:
\begin{eqnarray}
  \sum_{t=1}^T \inner{g_t}{w_{t+1} - w^\star} \leq \Phi(w^\star) - \Phi(w_1).
  \label{eqn:btrl}
\end{eqnarray}


\paragraph{Step 2: relating BTRL to FTRL.} Our next task will be to upper bound $\sum_{t=1}^T \inner{g_t}{w_{t} - w_{t+1}}$, the difference of the cumulative losses of FTRL and BTRL.

\begin{lemma}[Stability]
\begin{eqnarray}
  \sum_{t=1}^T \inner{g_t}{w_{t} - w_{t+1}} \leq \frac1 \lambda \sum_{t=1}^T \| g_t \|_\star^2.
  \label{eqn:stab}
\end{eqnarray}
\end{lemma}
\begin{proof}
We will show that for every $t$, $\inner{g_t}{w_{t} - w_{t+1}} \leq \frac1\lambda \| g_t \|_\star^2$. To show this, by generalized Cauchy-Schwarz, it suffices to show that
\[ \| w_t - w_{t+1} \| \leq \frac1\lambda \| g_t \|_\star. \]
By definition of $w_t = \nabla \Phi^\star(-G_{t-1})$ and $w_{t+1} = \nabla \Phi^\star(-G_t)$, we see that
\[ \| w_t - w_{t+1} \| = \| \nabla \Phi^\star(-G_{t-1}) - \nabla \Phi^\star(-G_t) \|. \]
Recall that $\Phi$ is $\lambda$-strongly convex, by Fact~\ref{fact:sc-sm}, $\Phi^\star$ is $\frac1\lambda$-smooth. Therefore the right hand side is indeed at most
$\frac1\lambda \| -G_{t-1} - (-G_t)\| = \frac1\lambda \| g_t \|_\star$.
\end{proof}

The theorem is proved by summing Equations~\eqref{eqn:btrl} and~\eqref{eqn:stab} together.
\end{proof}

\subsection{FTRL for general OCO}
It turns out that a low-regret algorithm for OLO immediately yields an algorithm for OCO.
To see this, suppose that at every iteration $t$, $f_t$ is a general convex function.
Now, suppose that $g_t \in \partial f_t(w_t)$ is a subgradient of $f_t$ at location $x_t$.
We have that for any $w^\star$,
\[ f_t(w_t) - f_t(w^\star) \leq \inner{g_t}{w_t - w^\star}. \]

Therefore, if we let $\tilde{f}_t(w) = \inner{g_t}{w}$, and run FTRL on $\tilde{f}_t$'s, we get that
\[ \sum_{t=1}^T \inner{g_t}{w_t - w^\star} \leq \R(T) \]
for some regret function $\R(T)$. This implies that
\[ \Reg(T, w^\star) = \sum_{t=1}^T f_t(w_t) - f_t(w^\star) \leq \sum_{t=1}^T \inner{g_t}{w_t - w^\star} \leq \R(T). \]

\subsection{Instantiations of FTRL: theoretical guarantees}

\begin{enumerate}
  \item Online gradient descent (OGD)~\cite{zinkevich2003online}: $\Phi(w) = \frac{1}{2\eta}\| w \|_2^2$, which is $\frac1\eta$-strongly convex wrt $\| \cdot \|_2$. FTRL with $\Phi$ has regret
  \[ \Reg(T, w^\star) \leq \frac{\| w^\star \|_2^2}{2\eta} + \eta \sum_{t=1}^T \| g_t \|_2^2, \]
  for all benchmark $w^\star \in \RR^d$.

  Suppose we would like to guarantee $\Reg(T, \Ccal)$ with
  $\Ccal \subset \cbr{w: \| w\| \leq B_2}$.
  If in addition, it is known apriori that $\| g_t \| \leq R_2$, then
  \[ \Reg(T, \Ccal) \leq \frac{B_2^2}{2\eta} + \eta T R_2^2. \]
  We can setting $\eta = \frac{B_2}{R_2\sqrt{2T}}$ that minimize the regret bound, which gives $B_2 R_2 \sqrt{2T}$.

  \item OGD with lazy projections:
  \[ \Phi(w) = \begin{cases} \frac{1}{2\eta}\| w \|_2^2 & w \in \Ccal \\ +\infty & w \notin \Ccal \end{cases}, \]
  which is also $\frac1\eta$-strongly convex wrt $\| \cdot \|_2$. Note that FTRL in this case ensures $w_t \in \Ccal$ at every round. This is useful in error or safety critical settings (for exmaple, taking actions in $\Ccal$ prevents self-driving cars from falling off cliffs).
  FTRL with $\Phi$ has regret:
  \[ \Reg(T, w^\star) \leq \frac{\| w^\star \|_2^2}{2\eta} + \eta \sum_{t=1}^T \| g_t \|_2^2, \]
  for all benchmark $w^\star \in \Ccal$. Again, setting $\eta = \frac{B_2}{R_2\sqrt{2T}}$ guarantees $\Reg(T, \Ccal) \leq B_2 R_2 \sqrt{2T}$.

  \item $p$-norm algorithms ($p \in (1, 2]$)~\cite{grove2001general,gentile2003robustness}: It is known that $\Phi(w) = \frac{1}{2\eta}\| w \|_p^2$ is $\frac{p-1}\eta$-strongly convex wrt $\| \cdot \|_p$. FTRL with $R$ has regret:
  \[ \Reg(T, w) \leq \frac{\| w \|_p^2}{2\eta} + \frac{\eta}{p-1} \sum_{t=1}^T \| g_t \|_q^2. \]
  If $\Ccal \subset \cbr{w: \| w \|_p \leq B_p}$, and for all $t$, $\| g_t \|_q \leq R_q$,
  setting $\eta = \frac{B_p}{R_q\sqrt{2(p-1)T}}$ implies that
  \[ \Reg(T, \Ccal) \leq B_p R_q \sqrt{\frac{2T}{p-1}}. \]

  \item Exponentiated gradient (Hedge)~\cite{freund1997decision, kivinen1997exponentiated}: consider the negative entropy regularizer
  \[ \Phi(w) = \begin{cases} \frac{1}{\eta} \sum_{i=1}^d w_i \ln x_i, & w \in \Delta^{d-1}, \\ +\infty, & \text{otherwise}. \end{cases} \]
  Recall that by the calibration exercise, $\Phi(w)$ is $1$-strongly convex with respect to $\| \cdot \|_1$. Therefore, FTRL with $R$ has regret:
  \[ \Reg(T, w^\star) \leq \frac{\sum_{i=1}^d w_i^\star \ln w_i^\star - \min_{w' \in \Delta^{d-1}}\sum_{i=1}^d w_i' \ln w_i'}{\eta} + \eta \sum_{t=1}^T \| g_t \|_\infty^2. \]

  It can be seen that $\sum_{i=1}^d w_i^\star \ln w_i^\star \leq 0$, on the other hand, $\min_{w' \in \Delta^{d-1}} \sum_{i=1}^d w_i' \ln w_i' = - \max_{w' \in \Delta^{d-1}} H(w)$,
  where $H(w)$ is the entropy of probability vector $w$. Therefore, it is $-\ln d$. This implies that the first term is at most $\frac{\ln d}{\eta}$. Now suppose we know that all $t$ is such that $\| g_t \|_\infty \leq R_\infty$, we have
  \[ \Reg(T, w) \leq \frac{\ln d}{\eta} + \eta T R_\infty^2. \]
  Setting $\eta = \frac{\sqrt{\ln d}}{R_\infty \sqrt{T}}$ gives that
  \[ \Reg(T, \Delta^{d-1}) \leq 2 R_\infty \sqrt{T \ln d}. \]

  (The above regularizer can also be used to deal with a scaled version of probability simplex:
  \[ \cbr{w: \forall i, w_i > 0, \sum_{i=1}^d w_i = B_1}, \]
  for general $B_1 > 0$; we skip the discussion for brevity.)


\end{enumerate}

\subsection{Applications of FTRL to online linear classification}
\begin{algorithm}
\caption{Online linear classification (with FTRL)}
\begin{algorithmic}
\REQUIRE{Regularizer $R$, stepsize $\eta$.}
\FOR{timesteps $t = 1,2,\ldots,T$:}
\STATE Learner chooses $w_t = \argmin_{w} \del{ \frac{1}{\eta}\Phi(w) + \sum_{s=1}^{t-1} \inner{g_s}{w}} =  \nabla (\frac{1}{\eta} \Phi)^\star(-\sum_{s=1}^{t-1} g_s) \in \RR^d$,
\STATE Learner receives an example $(x_t, y_t)$.
\STATE Learner suffers from zero-one loss $M_t = \one(\inner{w_t}{y_t x_t} \leq 0)$.
\STATE Induced loss $f_t(w) = \one(\inner{w_t}{y_t x_t} \leq 0)(1 - \inner{w}{y_t x_t})$.
\STATE Let $g_t = \nabla f_t(w) |_{w = w_t} = \begin{cases} 0 & M_t = 0 \\ -y_t x_t & M_t = 1 \end{cases} \in \partial f_t(w_t)$.
\ENDFOR
\STATE Goal: minimize cumulative zero-one loss $\sum_{t=1}^T M_t$.
\end{algorithmic}
\end{algorithm}

\begin{theorem}
Suppose $R$ is $1$-strongly convex defined on $\Ccal$ with
with respect to $\| \cdot \|$, and for all $x_t$, $\| x_t \|_\star \leq R$.
Moreover, suppose for all $w$, $\Phi(w) \geq \Phi_{\min}$.
%$w, w' \in \Ccal$, $R(w) - R(w') \leq \Phi$
Then, for any $w^\star \in \Ccal$,
\[ \sum_{t=1}^T M_t \leq \frac{1}{1-\eta R^2} \del{L_T(w^\star) + \frac{\Phi(w^\star) - \Phi_{\min}}{\eta}}, \]
where $L_T(w) = \sum_{t=1}^T (1 - \inner{w}{y_t x_t})_+$ is the cumulative hinge loss of $w$.
%L_t(w) + B \sqrt{L_t(w)} + B^2
Specifically, if there exists $w^\star \in \Ccal$ such that the data is separable by a margin of 1: $\forall t, \inner{w^\star}{y_t x_t} \geq 1$, then setting $\eta = \frac{1}{2R^2}$ implies that
\[ \sum_{t=1}^T M_t \leq 2R^2 \cdot (\Phi(w^\star) - \Phi_{\min}), \]
in other words, the algorithm has a finite mistake bound.
\label{thm:ol-oc}
\end{theorem}

\begin{proof}
As $R$ is $1$-strongly convex wrt $\| \cdot \|$, $\frac{\Phi}{\eta}$ is $\frac1\eta$-strongly convex wrt $\| \cdot \|$.
By the guarantees of OCO with respect to $\cbr{f_t(\cdot)}$'s, we have that for all $w^\star$,
\[ \sum_{t=1}^T f_t(w_t) - \sum_{t=1}^T f_t(w^\star) \leq \frac{\Phi(w^\star) - \min_{w'}\Phi(w')}{\eta} + \sum_{t=1}^T \eta \|g_t\|^2 \leq \frac{\Phi(w^\star) - \Phi_{\min}}{\eta} + \sum_{t=1}^T \eta \|g_t\|^2, \]
where the second inequality uses the uniform lower bound of $\Phi$.

We have the following observations:
\begin{enumerate}
\item $g_t = 0$ if $M_t = 0$; therefore, the second term on the right hand side is at most $\eta R^2 (\sum_{t=1}^T M_t)$.

\item Moreover, $f_t(w_t) = \one(\inner{w_t}{y_t x_t} \leq 0)(1 - \inner{w_t}{y_t x_t})$. Observe that $f_t(w_t) \geq 0$. Moreover, if $M_t = 1$, then $f_t(w_t) \geq 1$. Therefore, $\sum_{t=1}^T M_t \leq \sum_{t=1}^T f_t(w_t)$.

\item $f_t(w) \leq \one(\inner{w_t}{y_t x_t} \leq 0)(1 - \inner{w}{y_t x_t})_+ \leq (1 - \inner{w}{y_t x_t})_+$, which is the instantaneous hinge loss of $w$.
\end{enumerate}

Combining the above insights, we get
\[ \sum_{t=1}^T M_t \cdot (1 - \eta R^2) \leq L_t(w^\star) + \frac{\Phi(w^\star) - \Phi_{\min}}{\eta}, \]
that is,
\[ \sum_{t=1}^T M_t \leq \frac{1}{1-\eta R^2} (L_t(w^\star) + \frac{\Phi(w^\star) - \Phi_{\min}}{\eta}). \]

The second claim of the theorem follows simply from algebra and the fact that $L_t(w^\star) = 0$.
\end{proof}

\paragraph{Instantiations.} We consider two settings of $\Phi$:
\begin{enumerate}
\item Let $\Phi(w) = \frac{1}{2}\|w\|^2$. This gives the well-known Perceptron algorithm~\cite{rosenblatt1958perceptron}:
\[ w_t = \argmin_{w} \del{ \frac{1}{2\eta}\| w \|_2^2 + \sum_{s=1}^{t-1} \inner{g_s}{w}} = -\eta \cdot \sum_{s=1}^{t-1} g_s. \]

%Then it can be checked that $\Phi$ can be set as $B^2$.
Suppose all examples lies in $\cbr{x: \|x\|_2 \leq R_2}$.
By Theorem~\ref{thm:ol-oc}, Perceptron has a mistake bound of
\[ \sum_{t=1}^T M_t \leq \frac{1}{1-\eta R_2^2}\del{L_T(w^\star) + \eta\| w^\star \|^2}, \]
for any $w^\star \in \RR^d$.

Now, if the data is linearly separable by margin $1$ by classifier $w$ such that $\| w \|_2 \leq B_2$, then setting $\eta = \frac{1}{2R_2^2}$ gives that
\[ \sum_{t=1}^T M_t \leq 2 R_2^2 B_2^2. \]
This is a variant of the well-known Percetron convergence theorem by Novikoff~\cite{rosenblatt1958perceptron}.

\item Let $\Phi(w) = \begin{cases} \sum_{i=1}^d w_i \ln w_i, & w \in \Delta^{d-1}, \\ +\infty, & \text{otherwise}. \end{cases}$. This gives the  Winnow~\cite{littlestone1988learning} algorithm:
\[ w_{t,i} = \exp{-\eta \sum_{s=1}^{t=1} g_{s,i}}, \forall i \in \cbr{1,\ldots,d}. \]

Suppose all examples lies in $\cbr{x: \|x\|_\infty \leq R_\infty}$. Also, as discussed before, we can set $\Phi_{\min} = -\ln d$ and $\Phi(w) - \Phi_{\min} \leq \ln d$ for all $w^\star \in \Delta^{d-1}$. Therefore,
FTRL with $\Phi$ has a mistake bound of
\[ \sum_{t=1}^T M_t \leq \frac{1}{1-\eta R_\infty^2}\del{L_T(w^\star) + \eta \ln d}. \]
for all $w^\star \in \Delta^{d-1}$.

If the data is linearly separable by margin $1$ by classifier $w^\star$ in $\Delta^{d-1}$, then setting $\eta = \frac{1}{2R_\infty^2}$ gives that
\[ \sum_{t=1}^T M_t \leq 2 R_\infty^2 \ln d. \]
This mistake bound is in general incomparable with the Perceptron mistake bound (see our discussions on $\ell_2$-$\ell_2$ vs. $\ell_1$-$\ell_\infty$ margin bounds before.)
\end{enumerate}


\subsection{FTRL with adaptive regularization}
As we have seen before, the choice of regularizer is crucial to obtain good online prediction performance. However, if we are faced with a stream of data, it is difficult to know which regularizer to choose ahead of the time.
In this section, we will look at FTRL with adaptive regularization, which is a systematic way to achieve online performance guarantees that adapts to the geometry of the data on the fly.

Our starting point is to consider the following algorithm:
\[ w_t = \argmin_w \del{ \Phi_{t-1}(w) + \sum_{s=1}^{t-1} \inner{g_s}{w} } = \nabla \Phi_{t-1}^\star(-G_{t-1}), \]
where $\cbr{\Phi_{t}}_{t=0}^T$ is a sequence of regularizers, and
recall that $G_{t-1} = \sum_{s=1}^{t-1} g_s$ is the sum of the gradients up to time $t-1$.
We called the above algorithm FTRL with adaptive regularization, abbreviated as FTRL-AR.
Specifically, we will be looking at sequences of $\cbr{\Phi_t}$'s such that they are generated on the fly, and can thus carry information on the past $g_t$'s.

\begin{theorem}[Modified from Lemma 1 of~\cite{orabona2015generalized}]
Suppose FTRL-AR uses $\Phi_t$'s that are $1$-strongly convex with respect to time-varying norm $\| \cdot \|_{t}$.
Then it has the following upper bound on its cumulative loss guarantee:
\[ \sum_{t=1}^T \inner{g_t}{w_t} \leq R_0^\star(0) - R_T^\star(-G_T) + \sum_{t=1}^T \| g_t \|_{\star, t-1}^2. \]
Consequently,
\[ \Reg(T, w^\star) = \sum_{t=1}^T \inner{g_t}{x_t - w^\star} \leq R_T(w^\star) + R_0^\star(0) + \sum_{t=1}^T \| g_t \|_{\star, t-1}^2. \]
\label{thm:ftrl-ar}
\end{theorem}

Note that the above theorem supercedes Theorem~\ref{thm:ftrl}, as it is a direct consequence of the above theorem by taking $R_t \equiv R_0$ for all $t$, and observing that $R_0^\star(0) = -\min_{w'} R_0(w')$.

\begin{proof}
It suffices to show that
\[ \inner{g_t}{w_t} \leq R_{t-1}^\star(-G_{t-1}) - R_t^\star(-G_t) + \| g_t \|_{\star, t-1}^2, \]
as the theorem concludes by summing this inequality up over all $t$'s.

To show the above inequality, it suffices for us to show that
\[ R_t^\star(-G_t) - R_{t-1}^\star(-G_{t-1}) + \inner{g_t}{w_t} \leq \| g_t \|_{\star, t-1}^2. \]

The above inequality is true by the following observations: first, as $R_t \geq R_{t-1}$, $R_t^\star \leq R_{t-1}^\star$; second, $w_t = \nabla R_{t-1}^\star(-G_{t-1})$, therefore,
the left hand side of the inequality is at most
\[ R_{t-1}^\star(-G_t) - R_{t-1}^\star(-G_{t-1}) - \inner{\nabla R_{t-1}^\star(-G_{t-1})}{-g_t} = D_{R_{t-1}^\star}(-G_t, -G_{t-1}); \]
recall that $D_f(\cdot, \cdot)$ is the Bregman divergence induced by $f$.
third, as $R_{t-1}$ is 1-strongly convex wrt $\| \cdot \|_{t-1}$, $R_{t-1}^\star$ is 1-smooth wrt $\| \cdot \|_{\star, t-1}$, implying that the right hand side is at most $\frac12 \| -G_t - (-G_{t-1}) \|_{\star, t-1}^2 = \frac12 \| g_t \|_{\star, t-1}^2$.
\end{proof}

Using the above meta-theorem, we can instantiate with different adpative regularizers and get online learning algorithms with different degrees of adaptivity.

\paragraph{Online gradient descent with adaptive step-sizes~\cite{zinkevich2003online}.} One instantiation of the above result is to let
\[ \Phi_t(w) = \frac{\sqrt{t+1}}{2\eta_0} \| w \|_2^2 = \frac12\| w \|_{A_t}^2. \]
where $A_t = \frac{\sqrt{t+1}}{\eta_0} I_d$.
Observe that $\Phi_t(w)$ is 1-strongly convex with norm $\| w \|_t = \| w \|_{A_t}$. Meanwhile, $\| g \|_{t,\star} = \| g \|_{A_t^{-1}}$.

Theorem~\ref{thm:ftrl-ar} implies that,
\[ \Reg(T, w^\star) \leq \frac{\sqrt{T+1}}{2\eta_0} \| x^\star \|_2^2 + \sum_{t=1}^T \eta_0 \cdot \frac{\| g_t \|^2}{\sqrt{t}}.  \]

Suppose the benchmark set $\Ccal$ is defined as $\cbr{w: \| w^\star \| \leq B_2}$.
If one knows that $\| g_t \|_2 \leq R_2$, then setting $\eta_0 = \frac{R_2}{B_2}$ gives
\[ \Reg(T, w^\star) \leq O\del{R_2 B_2 \sqrt{T}}, \quad \forall w \in \Ccal. \]
Even we don't have any prior knowledge on the norm of the $g_t$'s, setting $\eta_0 = 1$ gives
\[ \Reg(T, w^\star) \leq O\del{(R_2^2 + B_2^2) \sqrt{T}}, \quad \forall w \in \Ccal. \]

\paragraph{Regularization that depends on historical gradient lengths.} There is a variant of the above $\ell_2$ regularization scheme with another setting of the regularization strength:
\[ \Phi_t(w) = \frac{\sqrt{\sigma + \sum_{s=1}^{t} \| g_s \|^2}}{2 \eta_0} \| w \|^2 = \frac12\|w\|_{A_t}^2, \]
where $A_t = \frac{\sqrt{\sigma + \sum_{s=1}^{t} \| g_s \|^2}}{\eta_0} I_d$,
for some $\sigma > 0$.

Theorem~\ref{thm:ftrl-ar} implies that, with this setting of $\Phi_t$,
\[ \Reg(T, w^\star) \leq \frac{\sqrt{\sigma + \sum_{s=1}^{t} \| g_s \|^2}}{2 \eta_0} \| w^\star \|^2 + \sum_{s=1}^t \frac{\eta_0 \| g_s \|^2}{\sqrt{\sigma + \sum_{s=1}^{t} \| g_s \|^2}}\]
If $\sigma \geq \max_{t=1}^T \| g_t \|_2^2$, it can be shown that the right hand side is at most
\[ O\del{ \sqrt{\sigma + \sum_{s=1}^{t} \| g_s \|^2} \del{\frac{\|w^\star\|^2}{\eta_0} + \eta_0} }.\]
If $\eta_0 = \| w^\star \|$, and $\sigma$ is a constant factor away from $\max_{t=1}^T \| g_t \|_2^2$, then the regret guarantee is $O(\|w^\star\| \sqrt{\sum_{s=1}^{t} \| g_s \|^2})$, which can be much better than $R_2^2 B_2^2$.


\paragraph{Adaptive subgradient methods (Adagrad)~\cite{duchi2011adaptive}.} More generally we can allow adaptive Mahalanobis norm-based regularization. Specifically, we can let
\[ R_t(x) = \frac12 \| x \|_{A_t}^2, \]
for some adaptively generated $A_t$.

Specifically, one can let
\[ A_t = \frac1\eta (\sigma I + \diag( \sum_{s=1}^t g_s g_s^\top) )^\frac12\] be an "diagonal" adaptive regularizer.

Alternatively, one can let
\[ A_t = \frac1\eta (\sigma I + \sum_{s=1}^t g_s g_s^\top )^\frac12 \]
be an ``nondiagnoal'' adaptive regularizer.

\section{OCO for strongly convex functions}

Motivating example: SVM optimization:
\[ \min_{w} \sum_{t=1}^T \del{\frac\lambda2\|w\|_2^2 + (1-\inner{w}{y_t x_t})_+}. \]
Here $f_t(w) = \frac\lambda2\|w\|_2^2 + (1-\inner{w}{y_t x_t})_+$. If one can get a low regret $R(T)$, then one can use online-to-batch conversion to get a $f$ that has excess expected regularized loss $\frac{R(T)}{T}$.

One can show that if all $f_t$'s are $\lambda$-strongly convex, one can design a better OCO algorithm with regret bound much better than $O(\sqrt{T})$, that is, $O(\ln T)$.

How to achieve this? We will use the adaptive regularization method developed in the last section. Recall that AR-FTRL has the following regret guarantee:
\[ \sum_{t=1}^T \inner{g_t}{x_t - x^\star} \leq R_0^\star(0) + R_T(x^\star) + \sum_{t=1}^T \| g_t \|_{\star, t-1}^2. \]
How can the above regret relate to $\Reg(T, x^\star) = \sum_{t=1}^T f_t(x_t) - f_t(x^\star)$? Now because $f_t$ is $\lambda$-strongly convex, we have a tighter bound on it. Specifically,
\[ \Reg(T, x^\star) \leq \sum_{t=1}^T \inner{g_t}{x_t -x^\star} - \sum_{t=1}^T \frac\lambda 2\| x_t - x^\star \|^2. \]

This motivates us to define $R_t(x) = \frac\lambda 2\| x \|^2 + \sum_{s=1}^t \frac\lambda 2\| x_s - x \|^2$ so that $R_T(x^\star)$ cancels out the negative terms induced by linear approximation.
Observe that $R_t$ is 1-strongly convex with respect to $\| \cdot \|_{\lambda(t+1) I}$.
We therefore get:
\[ \Reg(T, x^\star) \leq \frac{\lambda}{2}\|x\|^2 + \sum_{t=1}^T \frac{\| g_t \|^2}{\lambda t}. \]

%The bottom line:

\section{OCO for exp-concave functions}

\paragraph{Motivating example 1: sequential investing.} There are $d$ stocks, with different growth rates every day.

$W_1 \gets 1$.

For $t = 1,2,\ldots,T$:
\begin{enumerate}
\item Given the current wealth $W_t$, allocate $p_t \in \Delta^{d-1}$ (spend $p_{t,i}$ fraction of current wealth to stock $i$)
\item Receive loss $f_t(p_t) = -\ln(\inner{c_t}{p_t})$, where $c_t \in \RR^d_+$, and $c_{t,i}$ is the ratio of the stock $i$ at the .
\item Sell all stocks, get new wealth $W_{t+1}$. Observe that
\[ W_{t+1} = W_t \del{\sum_{t=1}^T p_{t,i} c_{t,i}}, \]
i.e. $\ln(W_{t+1}) = \ln(W_t) - f_t(p_t)$. Therefore, maximizing $W_{T+1}$ amounts to minimizing the cumulative loss $\sum_{t=1}^T f_t(p_t)$.
\end{enumerate}

Goal: compete with the best constant rebalanced portfolio in hindsight (abbrev. CRP; that is, at the beginning of every day, allocate a constant fraction $q \in \Delta^{d-1}$ to all stocks.) Concretely,
\[ \Reg(T, q) = \sum_{t=1}^T f_t(p_t) - \sum_{t=1}^T f_t(q). \]


\paragraph{Motivating example 2: online least squares regression.}

For $t = 1,2,\ldots,T$:
\begin{enumerate}
\item Output a linear predictor $w_t \in \RR^d$.
\item Receive example $(x_t, y_t) \in \RR^d \times \RR$.
\item Suffer loss $f_t(w_t)$, where $f_t(w) = \frac12(\inner{w}{x_t} - y_t)^2$.
\end{enumerate}

\[ \Reg(T, w^\star) = \sum_{t=1}^T f_t(w_t) - \sum_{t=1}^T f_t(w^\star). \]

The common characteristic of the above two OCO problems are that the $f_t$'s are structured:
they are compositions of a univariate ``strongly convex'' function and a linear function. It turns out that they both belong to the family called {\em exp-concave} functions.

\begin{definition}
$f$ is called $\alpha$-exp-concave, if $\exp(-\alpha f(x))$ is a concave function.
\end{definition}

Clearly, $f(x) = -\ln(\inner{c}{x})$ is 1-exp-concave.

\begin{lemma}
$f$ is $\alpha$-exp-concave, iff for every $x$,
\[ \nabla^2 f(x) \succeq \alpha \nabla f(x) \cdot \nabla f(x)^\top. \]
\end{lemma}
\begin{proof}
$h = \exp(-\alpha f(x))$ is concave iff for every $x$, the hessian of $h$ is negative
semidefinite.
Observe that
\[ \nabla^2 h(x) = \alpha^2 \nabla f(x) \nabla f(x)^\top \exp(-\alpha f(x)) - \alpha \nabla^2 f(x) \exp(-\alpha f(x)) \preceq 0. \]
\end{proof}

It can be readily seen that for $\alpha < \gamma$, if $f$ is $\gamma$-exp-concave, then $f$ is $\alpha$-exp-concave.

\begin{lemma}
Suppose $h$ is $\lambda$-strongly convex and has gradient at most $G$. Then for any $sw$, $h(\inner{w}{x})$ is $\frac{\lambda}{G^2}$-exp-concave.
\end{lemma}

For online least-square regression with domain $\cbr{w: \| w\|_2 \leq B}$ and all $x \in \cbr{x: \| x \|_2 \leq R}$ and $y \in [-Y, Y]$,
one can take $h(z) = \frac12(z - y)^2$, which is $1$-strongly convex, and has gradient norm at most $RB+Y$. Therefore, $\frac12(\inner{w}{x}-y)^2$ is $\frac{1}{(RB+Y)^2}$-exp-concave.

For exp-concave functions, one can have a more refined lower bound than linear approximation.
\begin{lemma}
If $f$ is $\alpha$-exp-concave and $G$-Lipschitz,
then for any two points $u, v \in \cbr{x: \| x \|_2 \leq B}$, we have
\[ f(u) \geq f(v) + \inner{\nabla f(v)}{u - v} + \frac{\tilde{\alpha}}{2}(u - v)^\top \nabla f(v) \nabla f(v)^\top (u - v), \]
where $\tilde{\alpha} = \min(\frac{1}{8BR}, \frac{1}{2\alpha})$.
\label{lem:quad-approx}
\end{lemma}

\paragraph{Algorithm with logarithmic regret: adaptive regularization.} We will be using Lemma~\ref{lem:quad-approx} and the insights similar to OCO for strongly-convex optimization to develop an algorithm with a $O(\log T)$ regret.

Recall that AR-FTRL has the following regret guarantee:
\[ \sum_{t=1}^T \inner{g_t}{x_t - x^\star} \leq R_0^\star(0) + R_T(x^\star) + \sum_{t=1}^T \| g_t \|_{\star, t-1}^2. \]

In addition, by Lemma~\ref{lem:quad-approx}, we have that
\[ \sum_{t=1}^T f_t(x_t) - f_t(x^\star) \leq \sum_{t=1}^T \inner{g_t}{x_t - x^\star} -  \sum_{t=1}^T \frac{\tilde{\alpha}}{2}(x^\star - x_t)^\top \nabla f(x_t) \nabla f(x_t)^\top (x^\star - x_t) \]

This motivates us to set $R_T(x) = \frac\sigma2 \|x\|_2^2 + \sum_{t=1}^T \frac{\tilde{\alpha}}{2}(x - x_t)^\top \nabla f(x_t) \nabla f(x_t)^\top (x - x_t)$. Observe that for every $t$, $R_t(x)$ is $\sigma$-strongly convex with respect to $\| \cdot \|_t = \| \cdot \|_{A_t}$, where $A_t = \sigma I + \sum_{t=1}^T \nabla f(x_t) \nabla f(x_t)^\top$.

This gives that
\[ \Reg(T, x^\star) \leq \frac\sigma2 \|x^\star\|_2^2 + \sum_{t=1}^T \| g_t \|_{A_{t-1}^{-1}}^2. \]

\bibliographystyle{plain}
\bibliography{learning}

\end{document}
